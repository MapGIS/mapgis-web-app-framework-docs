

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> overlay/scene-overlay.js</title>

  <script src="../cdn/run_prettify.js"></script>
  <script src="../cdn/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="../cdn/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="../cdn/googleapis.css" rel="stylesheet">
  <link href="../cdn/prettify.css" rel="stylesheet">
  <link rel="stylesheet" href="../cdn/all.css" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="../cdn/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="../cdn/mapgis.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="../cdn/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="/">
                    <img class="mapgis-webclient-logo" src="/images/mapgis_blue.png" alt="logo">
                </a>
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API
                </a>
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            <div>
                <span class="mapgis-api-document-span"><a href="index.html">API文档</a></span>
            </div>
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="搜索文档..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><div class="mapgis-menu-span">类名</div><ul class="mapgis-sidebar-menus"><li><a href="AMapMercatorEMapLayer.html">AMapMercatorEMapLayer</a></li><li><a href="AMapMercatorEMapLayer.exports.AMapMercatorEMapLayer.html">exports.AMapMercatorEMapLayer</a></li><li><a href="AMapMercatorSatelliteAnnMapLayer.html">AMapMercatorSatelliteAnnMapLayer</a></li><li><a href="AMapMercatorSatelliteAnnMapLayer.exports.AMapMercatorSatelliteAnnMapLayer.html">exports.AMapMercatorSatelliteAnnMapLayer</a></li><li><a href="AMapMercatorSatelliteMapLayer.html">AMapMercatorSatelliteMapLayer</a></li><li><a href="AMapMercatorSatelliteMapLayer.exports.AMapMercatorSatelliteMapLayer.html">exports.AMapMercatorSatelliteMapLayer</a></li><li><a href="ArcGISMapImageLayer.html">ArcGISMapImageLayer</a></li><li><a href="ArcGISMapImageLayer.exports.ArcGISMapImageLayer.html">exports.ArcGISMapImageLayer</a></li><li><a href="ArcGISSublayer.html">ArcGISSublayer</a></li><li><a href="ArcGISTileLayer.html">ArcGISTileLayer</a></li><li><a href="ArcGISTileLayer.exports.ArcGISTileLayer.html">exports.ArcGISTileLayer</a></li><li><a href="CoordinateTransformation.html">CoordinateTransformation</a></li><li><a href="DataFlowLayer.exports.DataFlowLayer.html">exports.DataFlowLayer</a></li><li><a href="Document.html">Document</a></li><li><a href="ElevationInfo.html">ElevationInfo</a></li><li><a href="FeatureExpressionInfo.html">FeatureExpressionInfo</a></li><li><a href="FeatureLayer.html">FeatureLayer</a></li><li><a href="FeatureLayer.exports.FeatureLayer.html">exports.FeatureLayer</a></li><li><a href="FeatureLayer.exports.IGSFeatureLayer.html">exports.IGSFeatureLayer</a></li><li><a href="GeoJsonLayer.html">GeoJsonLayer</a></li><li><a href="GeoJsonLayer.exports.GeoJsonLayer.html">exports.GeoJsonLayer</a></li><li><a href="GraphicsLayer.html">GraphicsLayer</a></li><li><a href="GraphicsLayer.exports.GraphicsLayer.html">exports.GraphicsLayer</a></li><li><a href="GroupLayer.html">GroupLayer</a></li><li><a href="GroupLayer.exports.GroupLayer.html">exports.GroupLayer</a></li><li><a href="IGSMapImageLayer.exports.IGSMapImageLayer.html">exports.IGSMapImageLayer</a></li><li><a href="IGSSceneLayer.html">IGSSceneLayer</a></li><li><a href="IGSSceneLayer.exports.IGSSceneLayer.html">exports.IGSSceneLayer</a></li><li><a href="IGSSublayer.html">IGSSublayer</a></li><li><a href="IGSTileLayer.html">IGSTileLayer</a></li><li><a href="IGSTileLayer.exports.IGSTileLayer.html">exports.IGSTileLayer</a></li><li><a href="IGSVectorLayer.exports.IGSVectorLayer.html">exports.IGSVectorLayer</a></li><li><a href="Layer.html">Layer</a></li><li><a href="Layer3D.html">Layer3D</a></li><li><a href="Layer.exports.Layer.html">exports.Layer</a></li><li><a href="LOD.html">LOD</a></li><li><a href="Map.html">Map</a></li><li><a href="MapImageLayer.html">MapImageLayer</a></li><li><a href="ModelCacheLayer.html">ModelCacheLayer</a></li><li><a href="ModelCacheLayer.exports.ModelCacheLayer.html">exports.ModelCacheLayer</a></li><li><a href="OGCWMSLayer.html">OGCWMSLayer</a></li><li><a href="OGCWMSLayer.exports.OGCWMSLayer.html">exports.OGCWMSLayer</a></li><li><a href="OGCWMTSLayer.html">OGCWMTSLayer</a></li><li><a href="OGCWMTSLayer.exports.OGCWMTSLayer.html">exports.OGCWMTSLayer</a></li><li><a href="Point3D.html">Point3D</a></li><li><a href="Point3D.exports.Point3D.html">exports.Point3D</a></li><li><a href="Rectangle3D.html">Rectangle3D</a></li><li><a href="Rectangle3D.exports.Rectangle3D.html">exports.Rectangle3D</a></li><li><a href="SceneLayer.html">SceneLayer</a></li><li><a href="SceneLayer.exports.SceneLayer.html">exports.SceneLayer</a></li><li><a href="Size.html">Size</a></li><li><a href="SpatialReference.html">SpatialReference</a></li><li><a href="SpatialReference.exports.SpatialReference.html">exports.SpatialReference</a></li><li><a href="STKTerrainLayer.html">STKTerrainLayer</a></li><li><a href="STKTerrainLayer.exports.STKTerrainLayer.html">exports.STKTerrainLayer</a></li><li><a href="Sublayer.html">Sublayer</a></li><li><a href="TileInfo.html">TileInfo</a></li><li><a href="TileLayer.html">TileLayer</a></li><li><a href="TileLayer.exports.MapImageLayer.html">exports.MapImageLayer</a></li><li><a href="TileLayer.exports.TileLayer.html">exports.TileLayer</a></li><li><a href="TileMatrixSet.html">TileMatrixSet</a></li><li><a href="VectorTileLayer.exports.VectorTileLayer.html">exports.VectorTileLayer</a></li><li><a href="WebTileLayer.html">WebTileLayer</a></li><li><a href="WebTileLayer.exports.WebTileLayer.html">exports.WebTileLayer</a></li><li><a href="WMSSublayer.html">WMSSublayer</a></li><li><a href="WMTSStyle.html">WMTSStyle</a></li><li><a href="WMTSSublayer.html">WMTSSublayer</a></li></ul><div class="mapgis-menu-span">全局</div><ul class="mapgis-sidebar-menus"><li><a href="global.html#CoordinateSystemType">CoordinateSystemType</a></li><li><a href="global.html#CoordinateSystemType%255Bundefined%255D">CoordinateSystemType[undefined]</a></li><li><a href="global.html#dataStoreEsGeoCode">dataStoreEsGeoCode</a></li><li><a href="global.html#dataStorePgQueryFeature">dataStorePgQueryFeature</a></li><li><a href="global.html#disposeDocInfo">disposeDocInfo</a></li><li><a href="global.html#ElevationMode">ElevationMode</a></li><li><a href="global.html#ElevationMode%255Bundefined%255D">ElevationMode[undefined]</a></li><li><a href="global.html#featureGeoJSONTofeatureIGS">featureGeoJSONTofeatureIGS</a></li><li><a href="global.html#featureIGSToFeatureGeoJSON">featureIGSToFeatureGeoJSON</a></li><li><a href="global.html#getDataBase">getDataBase</a></li><li><a href="global.html#getDataSource">getDataSource</a></li><li><a href="global.html#getDocs">getDocs</a></li><li><a href="global.html#getGDBData">getGDBData</a></li><li><a href="global.html#getGeoJSONFeatureBound">getGeoJSONFeatureBound</a></li><li><a href="global.html#getGeoJSONFeatureCenter">getGeoJSONFeatureCenter</a></li><li><a href="global.html#getGeoJSONFeaturesCenter">getGeoJSONFeaturesCenter</a></li><li><a href="global.html#getLayerFileds">getLayerFileds</a></li><li><a href="global.html#getLayerIndexesByNames">getLayerIndexesByNames</a></li><li><a href="global.html#getLayerIndexesByNamesOrCodes">getLayerIndexesByNamesOrCodes</a></li><li><a href="global.html#getLayerInfo">getLayerInfo</a></li><li><a href="global.html#getLayersByExtentOrName">getLayersByExtentOrName</a></li><li><a href="global.html#getLayersByIndexes">getLayersByIndexes</a></li><li><a href="global.html#getLayerUrlsByNamesOrCodes">getLayerUrlsByNamesOrCodes</a></li><li><a href="global.html#getMapInfoService">getMapInfoService</a></li><li><a href="global.html#getMapServiceInfo">getMapServiceInfo</a></li><li><a href="global.html#getTiles">getTiles</a></li><li><a href="global.html#getTotal">getTotal</a></li><li><a href="global.html#igsCombineQueryFeature">igsCombineQueryFeature</a></li><li><a href="global.html#igsQuery">igsQuery</a></li><li><a href="global.html#igsQuery3DFeature">igsQuery3DFeature</a></li><li><a href="global.html#igsQueryFeature">igsQueryFeature</a></li><li><a href="global.html#IGSSceneSublayerType">IGSSceneSublayerType</a></li><li><a href="global.html#LayerType">LayerType</a></li><li><a href="global.html#LayerType%255Bundefined%255D">LayerType[undefined]</a></li><li><a href="global.html#LengthUnit">LengthUnit</a></li><li><a href="global.html#LengthUnit%255Bundefined%255D">LengthUnit[undefined]</a></li><li><a href="global.html#LoadStatus">LoadStatus</a></li><li><a href="global.html#LoadStatus%255Bundefined%255D">LoadStatus[undefined]</a></li><li><a href="global.html#ModelCacheFormat">ModelCacheFormat</a></li><li><a href="global.html#ModelCacheFormat%255Bundefined%255D">ModelCacheFormat[undefined]</a></li><li><a href="global.html#query">query</a></li><li><a href="global.html#statisticField">statisticField</a></li><li><a href="global.html#statisticFieldByDS">statisticFieldByDS</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#uuid">uuid</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <span class="page-title-sub">overlay/scene-overlay.js</span>
                    <span class="page-title-main">Source</span>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { getGeoJSONFeatureCenter } from '../feature/feature-geojson';
export class SceneOverlays {
    static sceneOverlaysArray = [];
    entityArray = []; // 实体数组
    markerOptions = []; // 标注点的参数feature信息进行存储
    Cesium = undefined;
    viewer = undefined;
    vueCesium = undefined;
    screenSpaceEventHandler = undefined;
    static getInstance(Cesium, vueCesium, viewer) {
        let sceneOverlaysValue = this.sceneOverlaysArray.find((item) => {
            return item.viewer === viewer;
        });
        if (sceneOverlaysValue) {
            return sceneOverlaysValue.sceneOverlays;
        }
        sceneOverlaysValue = {
            viewer,
            sceneOverlays: new SceneOverlays(Cesium, vueCesium, viewer)
        };
        this.sceneOverlaysArray.push(sceneOverlaysValue);
        return sceneOverlaysValue.sceneOverlays;
    }
    constructor(Cesium, vueCesium, viewer) {
        this.Cesium = Cesium;
        this.vueCesium = vueCesium;
        this.viewer = viewer;
        this.screenSpaceEventHandler = new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);
    }
    /**
     * 根据给定点画线 可绘制贴地形线
     * @param  {String} name 名称
     * @param  {Array} pointsArray 点数组
     * @param  {Number} width 线的宽度
     * @param  {Color} color 线颜色(默认为蓝色)
     * @param  {Boolean} isHeight 设置是否识别带高度的坐标
     * @param  {Boolean} clampToGround 设置是否贴地形
     * @param  {Object} options 包含的附加属性
     * @returns {Entity} 绘制的线 移除通过removeEntity(entity)
     */
    addLine(name, pointsArray, width = '', colorParam = this.Cesium.Color.BLUE, isHeight = false, clampToGround = false, options = {}) {
        if (!this.viewer) {
            console.log('viewer缺失');
            return null;
        }
        if (!name || !pointsArray) {
            return null;
        }
        let posArr = null;
        if (isHeight) {
            posArr = this.Cesium.Cartesian3.fromDegreesArrayHeights(pointsArray);
        }
        else {
            posArr = this.Cesium.Cartesian3.fromDegreesArray(pointsArray);
        }
        const para = {
            name: name,
            polyline: {
                positions: posArr,
                width: width,
                material: colorParam,
                clampToGround
            }
        };
        const lineEntity = this.viewer.entities.add({ ...para, ...options });
        this.entityArray.push(lineEntity);
        return lineEntity;
    }
    /**
     * 画多边形区
     * @param  {String} name       名称
     * @param  {Array}  pointsArr  点数组（顺序是逆时针）
     * @param  {Color}  fillColor  区填充色 默认白色半透明 通过webSceneControl.getColor(red, green, blue, alpha)
     * @param  {Color}  outlineColor  外框线颜色 默认红色半透明
     * @param {Boolean} threeDimension 是否传入三维点 传入三维点则按照三维点解析
     * @param  {object}  options   其他参数 {outlineWidth：边线宽度}（画多边形无法生效）
     * @param  {boolean}  options.drawOutLine  是否在多边形边上画一条线（drawOutLine：true/false）
     * @see removeEntity
     * @return {entity}            绘制的多边形区对象 移除通过removeEntity(entity)
     */
    addPolygon(name, pointsArr, fillColor, outlineColor, threeDimension, options) {
        if (!this.viewer) {
            console.log('viewer');
            return null;
        }
        const fcolor = fillColor || this.Cesium.Color.WHITE.withAlpha(0.5);
        const olcolor = outlineColor || this.Cesium.Color.RED.withAlpha(0.5);
        const outlineWidth = options &amp;&amp; options.outlineWidth ? options.outlineWidth : 20;
        let posArr;
        if (threeDimension) {
            posArr = this.Cesium.Cartesian3.fromDegreesArrayHeights(pointsArr);
        }
        else {
            posArr = this.Cesium.Cartesian3.fromDegreesArray(pointsArr);
        }
        const para = {
            name: name,
            polygon: {
                hierarchy: posArr,
                material: fcolor,
                outline: true,
                outlineColor: olcolor,
                outlineWidth: outlineWidth
            }
        };
        const polygonEntity = this.viewer.entities.add({ ...para, ...options });
        this.entityArray.push(polygonEntity);
        if (!options)
            options = {};
        if (options.drawOutLine) {
            const a = pointsArr;
            this.addLine(name, a, outlineWidth, olcolor, 
            // 是否识别带高度的坐标
            false, 
            // 是否贴地形
            true, 
            // 附加属性
            {});
        }
        return polygonEntity;
    }
    /**
     * 根据给定点添加带洞多边形（二维）
     * @param  {String} name         名称
     * @param  {Array}  latLonOut  外圈坐标 ：[x1,y1,x2,y2,x3,y3]
     * @param  {Array}  lanLonIn   内圈:[[x1,y1,x2,y2,x3,y3]]
     * @param  {object} options      参数对象
     * @return {entity}              绘制的多边形区对象 移除通过removeEntity(entity)
     */
    addHolePolygon(name, latLonOut, lanLonIn, options) {
        if (!this.viewer) {
            console.log('viewer缺失');
            return null;
        }
        // const latLon_out = [95.1550, 30.8902, 95.1668, 30.8800, 95.1836, 30.8902, 95.1696, 30.91];
        // const lanLon_in = [[95.1617, 30.8902, 95.1668, 30.8882, 95.1766, 30.8939, 95.1696, 30.8996]];
        // const polygonEntity = this.webGlobe.appendHolePolygon(
        //   name,
        //   latLonOut,
        //   lanLonIn,
        //   options
        // )
        const holeHierars = [];
        if (lanLonIn &amp;&amp; lanLonIn.length > 0) {
            for (let i = 0; i &lt; lanLonIn.length; i++) {
                holeHierars.push(new this.Cesium.PolygonHierarchy(this.Cesium.Cartesian3.fromDegreesArray(lanLonIn[i])));
            }
        }
        const polyHierar = new this.Cesium.PolygonHierarchy(this.Cesium.Cartesian3.fromDegreesArray(latLonOut), holeHierars);
        const para = {
            name: name,
            polygon: {
                hierarchy: polyHierar,
                perPositionHeight: false,
                outline: true,
                outlineColor: this.Cesium.Color.RED.withAlpha(0.5),
                outlineWidth: 10,
                material: this.Cesium.Color.BLUE.withAlpha(0.5)
            }
        };
        const polygonEntity = this.viewer.entities.add({ ...para, ...options });
        this.entityArray.push(polygonEntity);
        return polygonEntity;
    }
    /**
     * 根据给定点画贴地多边形
     * @param  {Array} latLonOut   外圈坐标数组（经纬度）
     * @param  {Array} lanLonIn  内圈坐标数组（经纬度）:[[x1,y1,x2,y2,x3,y3]]
     * @param  {Color} color     填充颜色(默认不指定时为蓝色) 通过getColor(red, green, blue, alpha)
     */
    addGroundPolygon(latLonOut, lanLonIn, color) {
        if (!this.viewer) {
            console.log('viewer缺失');
            return null;
        }
        // const latLon_out = [95.1550, 30.8902, 95.1668, 30.8800, 95.1836, 30.8902, 95.1696, 30.91];
        // const lanLon_in = [[95.1617, 30.8902, 95.1668, 30.8882, 95.1766, 30.8939, 95.1696, 30.8996]];
        // const color = new cesium.ColorGeometryInstanceAttribute(0.0, 1.0, 1.0, 0.5);
        // const primitive = this.webGlobe.appendGroundPolygon(
        //   latLonOut,
        //   lanLonIn,
        //   color
        // )
        let polygonGeom = null;
        if (!latLonOut || latLonOut.length &lt;= 0) {
            return null;
        }
        if (lanLonIn === null || lanLonIn.length &lt;= 0) {
            polygonGeom = new this.Cesium.PolygonGeometry({
                polygonHierarchy: new this.Cesium.PolygonHierarchy(this.Cesium.Cartesian3.fromDegreesArray(latLonOut))
            });
        }
        else {
            const holePolygon = [];
            for (let i = 0; i &lt; lanLonIn.length; i++) {
                holePolygon.push(new this.Cesium.PolygonHierarchy(this.Cesium.Cartesian3.fromDegreesArray(lanLonIn[i])));
            }
            polygonGeom = new this.Cesium.PolygonGeometry({
                polygonHierarchy: new this.Cesium.PolygonHierarchy(this.Cesium.Cartesian3.fromDegreesArray(latLonOut), holePolygon)
            });
        }
        const polygonInstance = new this.Cesium.GeometryInstance({
            geometry: polygonGeom,
            id: `groundPolygon_${this.Cesium.AlgorithmLib.generateRandom()}`,
            attributes: {
                color: color
            }
        });
        const para = {
            geometryInstances: polygonInstance
        };
        const primitive = this.viewer.scene.primitives.add(new this.Cesium.GroundPrimitive(para));
        this.entityArray.push(primitive);
        return primitive;
    }
    /**
     * 根据给定点画贴地多边形(在三维地形上面添加)
     * @param  {String} name   多边形名称
     * @param  {Array} latLonsOut   外圈坐标数组（经纬度）
     * @param  {Array} latLonsIn  内圈坐标数组（经纬度）:[[x1,y1,x2,y2,x3,y3]]
     * @param  {Object} options      参数对象
     * @param  {Number} step     线性插值步长
     */
    addHolePolygonOnTerrain(name, latLonsOut, latLonsIn, options, step) {
        if (!this.viewer) {
            console.log('viewer缺失');
            return null;
        }
        // const latLon_out = [95.1550, 30.8902, 95.1668, 30.8800, 95.1836, 30.8902, 95.1696, 30.91];
        // const lanLon_in = [[95.1617, 30.8902, 95.1668, 30.8882, 95.1766, 30.8939, 95.1696, 30.8996]];
        if (!step) {
            let len = 0;
            for (let i = 0; i &lt; latLonsOut.length / 2 - 1; i += 1) {
                len += Math.sqrt(
                // eslint-disable-next-line no-restricted-properties
                Math.pow(latLonsOut[2 * i] - latLonsOut[2 * (i + 1)], 2) +
                    // eslint-disable-next-line no-restricted-properties
                    Math.pow(latLonsOut[2 * i + 1] - latLonsOut[2 * (i + 1) + 1], 2));
            }
            step = len / 200;
        }
        // const primitive = this.webGlobe.appendHolePolygonOnTerrain(
        //   name,
        //   latLonsOut,
        //   latLonsIn,
        //   step,
        //   options
        // )
        const cartographics = [];
        const ellipsoid = this.viewer.scene.globe.ellipsoid;
        const num = latLonsOut.length / 2;
        const positions = [];
        for (let i = 0; i &lt; num; i++) {
            positions.push(new this.Cesium.Cartesian2(latLonsOut[i * 2], latLonsOut[2 * i + 1]));
        }
        const pnts = this.Cesium.AlgorithmLib.linearInterpolate(positions, step);
        if (pnts !== null &amp;&amp; pnts.length > 0) {
            for (let j = 0; j &lt; pnts.length; j++) {
                const cartographic = ellipsoid.cartesianToCartographic(this.Cesium.Cartesian3.fromDegrees(pnts[j].x, pnts[j].y, 0, ellipsoid));
                cartographics.push(cartographic);
            }
        }
        const outNum = [];
        outNum.push(cartographics.length); // 外圈点数
        if (latLonsIn &amp;&amp; latLonsIn.length > 0) {
            for (let k = 0; k &lt; latLonsIn.length; k++) {
                const lonLatArr_hole = latLonsIn[k];
                const num_hole = lonLatArr_hole.length / 2;
                const positions_hole = [];
                for (let m = 0; m &lt; num_hole; m++) {
                    positions_hole.push(new this.Cesium.Cartesian2(lonLatArr_hole[m * 2], lonLatArr_hole[2 * m + 1]));
                }
                const pnts_hole = this.Cesium.AlgorithmLib.linearInterpolate(positions_hole, step);
                if (pnts_hole !== null &amp;&amp; pnts_hole.length > 0) {
                    for (let n = 0; n &lt; pnts_hole.length; n++) {
                        const cartographic_tem = ellipsoid.cartesianToCartographic(this.Cesium.Cartesian3.fromDegrees(pnts_hole[n].x, pnts_hole[n].y, 0, ellipsoid));
                        cartographics.push(cartographic_tem);
                    }
                    outNum.push(cartographics.length);
                }
                positions_hole.length = 0;
            }
        }
        const promise = this.Cesium.sampleTerrain(this.viewer.terrainProvider, 16, cartographics);
        const self = this;
        self.Cesium.when(promise, function (updatedPositions) {
            const cartesianPositions = ellipsoid.cartographicArrayToCartesianArray(updatedPositions);
            const outPos = cartesianPositions.slice(0, outNum[0]);
            const inPolygonHierarchyArr = [];
            for (let i = 1; i &lt; outNum.length; i++) {
                inPolygonHierarchyArr.push(new self.Cesium.PolygonHierarchy(cartesianPositions.slice(outNum[i - 1], outNum[i])));
            }
            const polyHierar = new self.Cesium.PolygonHierarchy(outPos, inPolygonHierarchyArr);
            const para = {
                name: name,
                polygon: {
                    hierarchy: polyHierar,
                    perPositionHeight: true,
                    outline: true,
                    outlineColor: self.Cesium.Color.RED.withAlpha(0.5),
                    outlineWidth: 10,
                    material: self.Cesium.Color.BLUE.withAlpha(0.5)
                }
            };
            const retultEntity = self.viewer.entities.add({ ...para, ...options });
            self.entityArray.push(retultEntity);
        });
    }
    /**
     * 添加图标注记
     * @param  {String} text       注记文字内容
     * @param  {Number} lon        经度(必须)
     * @param  {Number} lat        纬度(必须)
     * @param  {Number} height     高程
     * @param  {String} font       字体 这里将字体和大小放在一起 eg:'14pt 楷体'
     * @param  {Color}  fillColor  字体的填充色
     * @param  {String} iconUrl    图标路径
     * @param  {Number} iconWidth  图标宽度
     * @param  {Number} iconHeight 图标高度
     * @param  {Number} farDist    最远显示距离
     * @param  {Number} nearDist   最近显示距离
     * @param  {String} txtPos     位置 'center','top','bottom'
     * @param  {String} attribute  其他属性信息
     * @param  {String} id  id
     * @return {entity} labelIcon  图标注记对象 移除通过removeEntity(entity)
     */
    addLabelIcon(opt) {
        if (!this.Cesium) {
            console.log('Cesium缺失');
            return null;
        }
        if (!opt.lon || !opt.lat) {
            return null;
        }
        const text = opt.text || '';
        const lon = opt.lon || 0;
        const lat = opt.lat || 0;
        const height = opt.height || 0;
        const font = opt.font || '14pt 宋体';
        const fillColor = opt.fillColor || '';
        const iconUrl = opt.iconUrl || null;
        const iconWidth = opt.iconWidth || 27;
        const iconHeight = opt.iconHeight || 32;
        const farDist = opt.farDist || 10000000000000;
        const nearDist = opt.nearDist || 1;
        const attribute = opt.attribute || '';
        opt.name = opt.name || 'pictureLabel';
        // const labelIcon = this.viewer.appendLabelIcon(
        //   text,
        //   lon,
        //   lat,
        //   height,
        //   font,
        //   fillColor,
        //   iconUrl,
        //   iconWidth,
        //   iconHeight,
        //   farDist,
        //   nearDist,
        //   txtPos,
        //   attribute
        // )
        let txtPos = this.Cesium.VerticalOrigin.TOP;
        if (opt.txtPos === undefined) {
            txtPos = this.Cesium.VerticalOrigin.BOTTOM;
        }
        else if (opt.txtPos === 'center') {
            txtPos = this.Cesium.VerticalOrigin.CENTER;
        }
        else if (opt.txtPos === 'top') {
            txtPos = this.Cesium.VerticalOrigin.TOP;
        }
        else {
            txtPos = this.Cesium.VerticalOrigin.BOTTOM;
        }
        const labelIcon = this.viewer.entities.add({
            name: text,
            position: this.Cesium.Cartesian3.fromDegrees(lon, lat, height),
            billboard: {
                // 图标
                image: iconUrl,
                width: iconWidth,
                height: iconHeight,
                // heightReference: this.root.HeightReference.CLAMP_TO_GROUND,
                // 随远近缩放
                // pixelOffset:new this.root.Cartesian2(0.0, -image.height),
                pixelOffsetScaleByDistance: new this.Cesium.NearFarScalar(1.5e5, 3.0, 1.5e7, 0.5),
                // 随远近隐藏
                translucencyByDistance: new this.Cesium.NearFarScalar(1.5e5, 1.0, 1.5e7, 0.0),
                // 定位点
                // verticalOrigin: this.root.VerticalOrigin.BOTTOM
                horizontalOrigin: this.Cesium.HorizontalOrigin.TOP
            },
            label: {
                // 文字标签
                text: text,
                font: font,
                style: this.Cesium.LabelStyle.FILL_AND_OUTLINE,
                fillColor: fillColor,
                outlineWidth: 1,
                verticalOrigin: this.Cesium.VerticalOrigin.BOTTOM,
                horizontalOrigin: this.Cesium.HorizontalOrigin.BOTTOM,
                // pixelOffset: lPixelOffset, // 偏移量
                // heightReference : this.root.HeightReference.CLAMP_TO_GROUND ,
                // 随远近缩放
                pixelOffset: new this.Cesium.Cartesian2(0.0, -iconHeight / 4),
                pixelOffsetScaleByDistance: new this.Cesium.NearFarScalar(1.5e2, 3.0, 1.5e7, 0.5),
                // 随远近隐藏
                translucencyByDistance: new this.Cesium.NearFarScalar(1.5e5, 1.0, 1.5e7, 0.0)
            },
            description: attribute
        });
        if (opt.id) {
            labelIcon.id = opt.id;
        }
        labelIcon.billboard.translucencyByDistance = new this.Cesium.NearFarScalar(1.5e5, 1.0, 1.5e7, 1.0); // 不随距离的远近改变透明度
        // labelIcon.pixelOffsetScaleByDistance = new cesium.NearFarScalar(1.5e2, 0.0, 8.0e6, 10.0);// 随远近改变大小
        labelIcon.billboard.disableDepthTestDistance = Number.POSITIVE_INFINITY;
        labelIcon.name = opt.name;
        this.entityArray.push(labelIcon);
        return labelIcon;
    }
    /**
     * 添加文字标签
     * @param {Number} lon             经度
     * @param {Number} lat             纬度
     * @param {Number} height          高程
     * @param {String} lText          标签内容
     * @param {Object} options
     * @param {String} [options.font='14pt monospace']         字体
     * @param {Color}  [options.fillColor =Cesium.Color.WHITE ]  字体的填充色
     * @param {Color}  [options.outlineColor =Cesium.Color.WHITE ]  字体的填充色
     * @param {LabelStyle} [options.style = Cesium.LabelStyle.FILL_AND_OUTLINE ]       样式
     * @param {Number} [options.outlineWidth =1 ] 外边线宽度
     * @param {Number} [options.heightReference =Cesium.HeightReference.NONE ] 外边线宽度
     * @param {VerticalOrigin} [options.verticalOrigin = Cesium.VerticalOrigin.CENTER] 标签位置 Cesium.VerticalOrigin.Cesium.VerticalOrigin.LEFT Cesium.VerticalOrigin.RIGHT
     * @param {HorizontalOrigin} [options.horizontalOrigin = Cesium.HorizontalOrigin.CENTER] 标签位置 Cesium.HorizontalOrigin.Cesium.HorizontalOrigin.LEFT Cesium.HorizontalOrigin.RIGHT
     * @param {String} [options.description]     属性描述
     * @returns {entity} 标签对象 移除通过removeEntity(entity)
     */
    addLabel(lon, lat, height, lText, options) {
        options = options || {};
        const lFont = options.font || '14pt monospace';
        const lFillColor = options.fillColor || this.Cesium.Color.WHITE;
        const lOutlineColor = options.outlineColor || this.Cesium.Color.WHITE;
        const lStyle = options.style || this.Cesium.LabelStyle.FILL_AND_OUTLINE;
        const lOutlineWidth = options.outlineWidth || 1;
        // 垂直位置
        const lVerticalOrigin = options.verticalOrigin || this.Cesium.VerticalOrigin.CENTER;
        // 水平位置
        const lHorizontalOrigin = options.horizontalOrigin || this.Cesium.HorizontalOrigin.CENTER;
        // 相对于原点的偏移量 以像素为单位（原点从左到右为x正方向→，从上到下为正方向↓）
        const lPixelOffset = options.pixelOffset || new this.Cesium.Cartesian2(0.0, 0.0);
        const lScaleByDistance = options.scaleByDistance ||
            new this.Cesium.NearFarScalar(1.5e2, 3.0, 1.5e7, 0.5);
        const lTransparentByDistance = options.transparentByDistance |
            new this.Cesium.NearFarScalar(1.5e5, 1.0, 1.5e7, 0.0); // 暂时不用，不然标签不会显示
        const lHeightReference = options.heightReference || this.Cesium.HeightReference.NONE;
        const backgroundColor = options.backgroundColor || new this.Cesium.Color(0.0, 0.0, 0.3, 0.6);
        const showBackground = options.showBackground || false;
        const disableDepthTestDistance = options.disableDepthTestDistance || Number.POSITIVE_INFINITY;
        const para = {
            name: '标签',
            position: this.Cesium.Cartesian3.fromDegrees(lon, lat, height),
            label: {
                // 文字标签
                text: lText,
                font: lFont,
                fillColor: lFillColor,
                style: lStyle,
                outlineWidth: lOutlineWidth,
                outlineColor: lOutlineColor,
                verticalOrigin: lVerticalOrigin,
                horizontalOrigin: lHorizontalOrigin,
                pixelOffset: lPixelOffset,
                heightReference: lHeightReference,
                pixelOffsetScaleByDistance: lScaleByDistance,
                // translucencyByDistance: lTransparentByDistance, // 随远近隐藏
                backgroundColor: backgroundColor,
                showBackground: showBackground,
                disableDepthTestDistance: disableDepthTestDistance
            },
            description: options.description // '这是一个标签的描述'
        };
        const alabel = this.viewer.entities.add({ ...para, ...options });
        this.entityArray.push(alabel);
        return alabel;
    }
    /**
     * 添加点
     * @param  {Number} lon 经度
     * @param  {Number} lat 纬度
     * @param  {Number} height 高程
     * @param  {String} name 名称
     * @param  {Number} pixelSize 像素大小
     * @param  {Color}  color 颜色
     * @param  {Color}  outlineColor 外边线颜色
     * @param  {Number} outlineWidth 边线宽度
     * @param  {String} description 属性描述信息
     * @returns {Entity} 返回点对象 移除通过removeEntity(entity)
     */
    addPoint(lon = 0, lat = 0, height = 0, name = 'pictureLabel', pixelSize = 6, color = this.Cesium.Color.RED, outlineColor = this.Cesium.Color.BLUE, outlineWidth = 0, description = '') {
        if (!this.Cesium) {
            console.log('Cesium缺失');
            return null;
        }
        if (!lon || !lat) {
            return null;
        }
        const pointEntity = this.viewer.entities.add({
            name,
            position: this.Cesium.Cartesian3.fromDegrees(lon, lat, height),
            point: {
                // 点
                pixelSize,
                color,
                outlineColor,
                outlineWidth
            },
            description
        });
        this.entityArray.push(pointEntity);
        return pointEntity;
    }
    /**
     * 添加标注点
     * @param {Object} option 参数对象
     * @returns {object} markerEntity
     */
    addMarker(option) {
        if (!this.Cesium) {
            console.log('Cesium缺失');
            return null;
        }
        if (!option.center &amp;&amp; !option.features) {
            return null;
        }
        option.img = option.img || null;
        option.stopEvent = option.stopEvent || true;
        // 鼠标悬浮事件
        option.mouseOver = option.mouseOver || null;
        // 鼠标移除事件
        option.mouseOut = option.mouseOut || null;
        // 查询结果
        option.AttValue = option.AttValue || null;
        // 结果表字段
        option.FldName = option.FldName || null;
        // 标注点ID
        option.name = option.name || 'markerOverlay';
        // 计算中心点
        option.center = option.center || getGeoJSONFeatureCenter(option.features[0]);
        const markerEntity = this.addLabelIcon({
            lon: option.center[0],
            lat: option.center[1],
            height: option.center.length > 2 ? option.center[2] : 0,
            iconUrl: option.img,
            iconWidth: option.iconWidth,
            iconHeight: option.iconHeight,
            name: option.name
        });
        if (!markerEntity) {
            return;
        }
        option.id = markerEntity._id;
        const { mouseOver, mouseOut, leftClick } = option;
        // 标注点添加鼠标事件
        option.mouseOver =
            mouseOver !== undefined &amp;&amp; mouseOver !== null
                ? mouseOver
                : (event) => {
                    this.markerMouseOver(event, option);
                };
        option.mouseOut =
            mouseOut !== undefined &amp;&amp; mouseOut !== null
                ? mouseOut
                : (event) => {
                    this.markerMouseOut(event, option);
                };
        option.leftClick =
            leftClick !== undefined &amp;&amp; leftClick !== null
                ? leftClick
                : (event) => {
                    this.markerLeftClick(event, option);
                };
        this.markerOptions.push(option);
        if (this.markerOptions.length == 1) {
            this.registerMarkerMouseEvent();
        }
        return markerEntity;
    }
    /**
     * 通过名称删除实体对象
     * @param  {string} name 实体对象
     */
    removeEntityByName(name) {
        const entities = this.entityArray;
        for (let i = this.entityArray.length - 1; i > -1; i -= 1) {
            if (entities[i] &amp;&amp; entities[i]._name &amp;&amp; entities[i]._name === name) {
                this.removeEntity(entities[i]);
            }
        }
        // 同时删除markerOptions里面存放的数据
        this.removeMarkerByName(name);
    }
    /**
     * 移除所有实体对象
     */
    removeAllEntities() {
        this.entityArray.forEach((entity) => {
            this.removeEntity(entity);
        });
        this.entityArray = [];
        if (this.markerOptions.length) {
            this.unregisterMarkerMouseEvent();
            this.markerOptions = [];
        }
    }
    /**
     * 注册标注鼠标事件
     */
    registerMarkerMouseEvent() {
        // 注册鼠标移动事件
        this.registerMouseEvent('MOUSE_MOVE', (event) => {
            // 标注点增加hover响应
            this.pickMarker(event);
        });
        this.registerMouseEvent('LEFT_CLICK', (event) => {
            if (this.markerOptions.length == 0)
                return;
            const options = this.markerOptions;
            const collection = this.viewer.scene.pick(event.position);
            for (let i = 0; i &lt; options.length; i += 1) {
                const option = options[i];
                if (collection &amp;&amp;
                    collection.id &amp;&amp;
                    collection.id._id &amp;&amp;
                    collection.id._id === option.id) {
                    option.leftClick(event);
                    break;
                }
            }
        });
    }
    /**
     * 注销标注鼠标事件
     */
    unregisterMarkerMouseEvent() {
        this.unRegisterMouseEvent('MOUSE_MOVE');
        this.unRegisterMouseEvent('LEFT_CLICK');
    }
    /**
     * 注册鼠标事件
     * @param  {String} eventType   事件类型 1:LEFT_CLICK 2:LEFT_DOWN 3:LEFT_UP 4:LEFT_DOUBLE_CLICK 5:RIGHT_DOWN 6:RIGHT_UP 7:RIGHT_CLICK 8:MOUSE_MOVE 9:WHEEL(鼠标滚轮)
     * @param  {Function} callbackFun 回调函数
     * @returns {handler}             事件句柄
     */
    registerMouseEvent(eventType, callbackFun) {
        if (this.screenSpaceEventHandler === undefined) {
            return;
        }
        const { ScreenSpaceEventType } = this.Cesium;
        let eventHandler;
        if (eventType === 'LEFT_CLICK') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.LEFT_CLICK);
        }
        else if (eventType === 'LEFT_DOWN') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.LEFT_DOWN);
        }
        else if (eventType === 'LEFT_UP') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.LEFT_UP);
        }
        else if (eventType === 'LEFT_DOUBLE_CLICK') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.LEFT_DOUBLE_CLICK);
        }
        else if (eventType === 'RIGHT_DOWN') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.RIGHT_DOWN);
        }
        else if (eventType === 'RIGHT_UP') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.RIGHT_UP);
        }
        else if (eventType === 'RIGHT_CLICK') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.RIGHT_CLICK);
        }
        else if (eventType === 'MOUSE_MOVE') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.MOUSE_MOVE);
        }
        else if (eventType === 'WHEEL') {
            eventHandler = this.screenSpaceEventHandler.setInputAction(function (movement) {
                if (typeof callbackFun === 'function') {
                    callbackFun(movement);
                }
            }, ScreenSpaceEventType.WHEEL);
        }
        return eventHandler;
    }
    /**
     * 注销鼠标事件
     * @param  {String} eventType 事件类型,1:LEFT_CLICK 2:LEFT_DOWN 3:LEFT_UP 4:LEFT_DOUBLE_CLICK 5:RIGHT_DOWN 6:RIGHT_UP 7:RIGHT_CLICK 8:MOUSE_MOVE 9:WHEEL
     * @returns {handler}             事件句柄
     */
    unRegisterMouseEvent(eventType) {
        if (this.screenSpaceEventHandler === undefined) {
            return;
        }
        const { ScreenSpaceEventType } = this.Cesium;
        if (eventType === 'LEFT_CLICK') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.LEFT_CLICK);
        }
        else if (eventType === 'LEFT_DOWN') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.LEFT_DOWN);
        }
        else if (eventType === 'LEFT_UP') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.LEFT_UP);
        }
        else if (eventType === 'LEFT_DOUBLE_CLICK') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.LEFT_DOUBLE_CLICK);
        }
        else if (eventType === 'RIGHT_DOWN') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.RIGHT_DOWN);
        }
        else if (eventType === 'RIGHT_UP') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.RIGHT_UP);
        }
        else if (eventType === 'RIGHT_CLICK') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.RIGHT_CLICK);
        }
        else if (eventType === 'MOUSE_MOVE') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.MOUSE_MOVE);
        }
        else if (eventType === 'WHEEL') {
            this.screenSpaceEventHandler.removeInputAction(ScreenSpaceEventType.WHEEL);
        }
    }
    /**
     * 移除指定实体
     * @param  {entity} entity 实体对象
     */
    removeEntity(entity) {
        if (!this.viewer) {
            console.log('viewer缺失');
            return;
        }
        this.viewer.entities.remove(entity);
        const entities = this.entityArray;
        for (let i = 0; i &lt; entities.length; i += 1) {
            if (entities[i] &amp;&amp; entities[i].id &amp;&amp; entities[i].id === entity.id) {
                entities.splice(i, 1);
                break;
            }
        }
    }
    /**
     * 只删除markerOptions里面存放的数据
     * @param  {string} name 实体对象
     */
    removeMarkerByName(name) {
        const markers = this.markerOptions;
        for (let i = 0; i &lt; markers.length; i += 1) {
            if (markers[i] &amp;&amp; markers[i].name &amp;&amp; markers[i].name === name) {
                markers.splice(i, 1);
            }
        }
        if (this.markerOptions.length == 0) {
            this.unregisterMarkerMouseEvent();
        }
    }
    markerMouseOver(event, option) { }
    markerMouseOut(event, option) { }
    markerLeftClick(event, option) { }
    /**
     * hover拾取标注
     * @param {Event} event 事件对象
     */
    pickMarker(event) {
        if (this.markerOptions.length == 0)
            return;
        const options = this.markerOptions;
        const collection = this.viewer.scene.pick(event.endPosition);
        for (let i = 0; i &lt; options.length; i += 1) {
            const option = options[i];
            if (collection &amp;&amp;
                collection.id &amp;&amp;
                collection.id._id &amp;&amp;
                collection.id._id === option.id) {
                option.mouseOver(event);
                break;
            }
            if (i === options.length - 1) {
                option.mouseOut(event);
                break;
            }
        }
    }
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>文档生成<a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a></p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>

</body>
</html>
