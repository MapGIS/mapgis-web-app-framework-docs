

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> dist/src/model/feature/arcgis-feature-query.js</title>

  <script src="../cdn/run_prettify.js"></script>
  <script src="../cdn/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="../cdn/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="../cdn/googleapis.css" rel="stylesheet">
  <link href="../cdn/prettify.css" rel="stylesheet">
  <link rel="stylesheet" href="../cdn/all.css" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="../cdn/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="../cdn/mapgis.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="../cdn/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="/">
                    <img class="mapgis-webclient-logo" src="/images/mapgis_blue.png" alt="logo">
                </a>
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API
                </a>
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        帮助向导
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            
                                <a class="dropdown-item" href="tutorial-1.快速入门.html">
                                    1.快速入门
                                </a>
                            
                        
                        </div>
                    </div>
                </div>
                 
                    
                        <a
                            class="link user-link "
                            href="/mapgis-web-app-framework-docs/api/index.html"
                        >
                            MapGIS-Web-App-Framework
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            <div>
                <span class="mapgis-api-document-span"><a href="index.html">API文档</a></span>
            </div>
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="搜索文档..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><div class="mapgis-menu-span">类名</div><ul class="mapgis-sidebar-menus"><li><a href="AMapMercatorEMapLayer.html">AMapMercatorEMapLayer</a></li><li><a href="AMapMercatorEMapLayer.exports.AMapMercatorEMapLayer.html">exports.AMapMercatorEMapLayer</a></li><li><a href="AMapMercatorSatelliteAnnMapLayer.html">AMapMercatorSatelliteAnnMapLayer</a></li><li><a href="AMapMercatorSatelliteAnnMapLayer.exports.AMapMercatorSatelliteAnnMapLayer.html">exports.AMapMercatorSatelliteAnnMapLayer</a></li><li><a href="AMapMercatorSatelliteMapLayer.html">AMapMercatorSatelliteMapLayer</a></li><li><a href="AMapMercatorSatelliteMapLayer.exports.AMapMercatorSatelliteMapLayer.html">exports.AMapMercatorSatelliteMapLayer</a></li><li><a href="ArcGISMapImageLayer.html">ArcGISMapImageLayer</a></li><li><a href="ArcGISMapImageLayer.exports.ArcGISMapImageLayer.html">exports.ArcGISMapImageLayer</a></li><li><a href="ArcGISSublayer.html">ArcGISSublayer</a></li><li><a href="ArcGISTileLayer.html">ArcGISTileLayer</a></li><li><a href="ArcGISTileLayer.exports.ArcGISTileLayer.html">exports.ArcGISTileLayer</a></li><li><a href="CoordinateTransformation.html">CoordinateTransformation</a></li><li><a href="DataFlowLayer.exports.DataFlowLayer.html">exports.DataFlowLayer</a></li><li><a href="Document.html">Document</a></li><li><a href="ElevationInfo.html">ElevationInfo</a></li><li><a href="FeatureExpressionInfo.html">FeatureExpressionInfo</a></li><li><a href="FeatureLayer.html">FeatureLayer</a></li><li><a href="FeatureLayer.exports.FeatureLayer.html">exports.FeatureLayer</a></li><li><a href="FeatureLayer.exports.IGSFeatureLayer.html">exports.IGSFeatureLayer</a></li><li><a href="GeoJsonLayer.html">GeoJsonLayer</a></li><li><a href="GeoJsonLayer.exports.GeoJsonLayer.html">exports.GeoJsonLayer</a></li><li><a href="GraphicsLayer.html">GraphicsLayer</a></li><li><a href="GraphicsLayer.exports.GraphicsLayer.html">exports.GraphicsLayer</a></li><li><a href="GroupLayer.html">GroupLayer</a></li><li><a href="GroupLayer.exports.GroupLayer.html">exports.GroupLayer</a></li><li><a href="IGSMapImageLayer.exports.IGSMapImageLayer.html">exports.IGSMapImageLayer</a></li><li><a href="IGSSceneLayer.html">IGSSceneLayer</a></li><li><a href="IGSSceneLayer.exports.IGSSceneLayer.html">exports.IGSSceneLayer</a></li><li><a href="IGSSublayer.html">IGSSublayer</a></li><li><a href="IGSTileLayer.html">IGSTileLayer</a></li><li><a href="IGSTileLayer.exports.IGSTileLayer.html">exports.IGSTileLayer</a></li><li><a href="IGSVectorLayer.exports.IGSVectorLayer.html">exports.IGSVectorLayer</a></li><li><a href="Layer.html">Layer</a></li><li><a href="Layer3D.html">Layer3D</a></li><li><a href="Layer.exports.Layer.html">exports.Layer</a></li><li><a href="LOD.html">LOD</a></li><li><a href="Map.html">Map</a></li><li><a href="MapImageLayer.html">MapImageLayer</a></li><li><a href="ModelCacheLayer.html">ModelCacheLayer</a></li><li><a href="ModelCacheLayer.exports.ModelCacheLayer.html">exports.ModelCacheLayer</a></li><li><a href="OGCWMSLayer.html">OGCWMSLayer</a></li><li><a href="OGCWMSLayer.exports.OGCWMSLayer.html">exports.OGCWMSLayer</a></li><li><a href="OGCWMTSLayer.html">OGCWMTSLayer</a></li><li><a href="OGCWMTSLayer.exports.OGCWMTSLayer.html">exports.OGCWMTSLayer</a></li><li><a href="Point3D.html">Point3D</a></li><li><a href="Point3D.exports.Point3D.html">exports.Point3D</a></li><li><a href="Rectangle3D.html">Rectangle3D</a></li><li><a href="Rectangle3D.exports.Rectangle3D.html">exports.Rectangle3D</a></li><li><a href="SceneLayer.html">SceneLayer</a></li><li><a href="SceneLayer.exports.SceneLayer.html">exports.SceneLayer</a></li><li><a href="Size.html">Size</a></li><li><a href="SpatialReference.html">SpatialReference</a></li><li><a href="SpatialReference.exports.SpatialReference.html">exports.SpatialReference</a></li><li><a href="STKTerrainLayer.html">STKTerrainLayer</a></li><li><a href="STKTerrainLayer.exports.STKTerrainLayer.html">exports.STKTerrainLayer</a></li><li><a href="Sublayer.html">Sublayer</a></li><li><a href="TileInfo.html">TileInfo</a></li><li><a href="TileLayer.html">TileLayer</a></li><li><a href="TileLayer.exports.MapImageLayer.html">exports.MapImageLayer</a></li><li><a href="TileLayer.exports.TileLayer.html">exports.TileLayer</a></li><li><a href="TileMatrixSet.html">TileMatrixSet</a></li><li><a href="VectorTileLayer.exports.VectorTileLayer.html">exports.VectorTileLayer</a></li><li><a href="WebTileLayer.html">WebTileLayer</a></li><li><a href="WebTileLayer.exports.WebTileLayer.html">exports.WebTileLayer</a></li><li><a href="WMSSublayer.html">WMSSublayer</a></li><li><a href="WMTSStyle.html">WMTSStyle</a></li><li><a href="WMTSSublayer.html">WMTSSublayer</a></li></ul><div class="mapgis-menu-span">全局</div><ul class="mapgis-sidebar-menus"><li><a href="global.html#addClass">addClass</a></li><li><a href="global.html#byteLength">byteLength</a></li><li><a href="global.html#clean">clean</a></li><li><a href="global.html#colorObjectToRgba">colorObjectToRgba</a></li><li><a href="global.html#CoordinateSystemType">CoordinateSystemType</a></li><li><a href="global.html#CoordinateSystemType%255Bundefined%255D">CoordinateSystemType[undefined]</a></li><li><a href="global.html#createUniqueString">createUniqueString</a></li><li><a href="global.html#dataStoreEsGeoCode">dataStoreEsGeoCode</a></li><li><a href="global.html#dataStorePgQueryFeature">dataStorePgQueryFeature</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#deepClone">deepClone</a></li><li><a href="global.html#disposeDocInfo">disposeDocInfo</a></li><li><a href="global.html#ElevationMode">ElevationMode</a></li><li><a href="global.html#ElevationMode%255Bundefined%255D">ElevationMode[undefined]</a></li><li><a href="global.html#executeWorkflow">executeWorkflow</a></li><li><a href="global.html#featureGeoJSONTofeatureIGS">featureGeoJSONTofeatureIGS</a></li><li><a href="global.html#featureIGSToFeatureGeoJSON">featureIGSToFeatureGeoJSON</a></li><li><a href="global.html#formatTime">formatTime</a></li><li><a href="global.html#getColorObject">getColorObject</a></li><li><a href="global.html#getDataBase">getDataBase</a></li><li><a href="global.html#getDataSource">getDataSource</a></li><li><a href="global.html#getDocs">getDocs</a></li><li><a href="global.html#getGDBData">getGDBData</a></li><li><a href="global.html#getGeoJSONFeatureBound">getGeoJSONFeatureBound</a></li><li><a href="global.html#getGeoJSONFeatureCenter">getGeoJSONFeatureCenter</a></li><li><a href="global.html#getGeoJSONFeaturesCenter">getGeoJSONFeaturesCenter</a></li><li><a href="global.html#getLayerFileds">getLayerFileds</a></li><li><a href="global.html#getLayerIndexesByNames">getLayerIndexesByNames</a></li><li><a href="global.html#getLayerIndexesByNamesOrCodes">getLayerIndexesByNamesOrCodes</a></li><li><a href="global.html#getLayerInfo">getLayerInfo</a></li><li><a href="global.html#getLayersByExtentOrName">getLayersByExtentOrName</a></li><li><a href="global.html#getLayersByIndexes">getLayersByIndexes</a></li><li><a href="global.html#getLayerUrlsByNamesOrCodes">getLayerUrlsByNamesOrCodes</a></li><li><a href="global.html#getMapInfoService">getMapInfoService</a></li><li><a href="global.html#getMapServiceInfo">getMapServiceInfo</a></li><li><a href="global.html#getTiles">getTiles</a></li><li><a href="global.html#getTotal">getTotal</a></li><li><a href="global.html#getWorkflowList">getWorkflowList</a></li><li><a href="global.html#getWorkflowResult">getWorkflowResult</a></li><li><a href="global.html#getWorkflowStatus">getWorkflowStatus</a></li><li><a href="global.html#hasClass">hasClass</a></li><li><a href="global.html#hexToRgba">hexToRgba</a></li><li><a href="global.html#html2Text">html2Text</a></li><li><a href="global.html#igsCombineQueryFeature">igsCombineQueryFeature</a></li><li><a href="global.html#igsQuery">igsQuery</a></li><li><a href="global.html#igsQuery3DFeature">igsQuery3DFeature</a></li><li><a href="global.html#igsQueryFeature">igsQueryFeature</a></li><li><a href="global.html#IGSSceneSublayerType">IGSSceneSublayerType</a></li><li><a href="global.html#isNumeric">isNumeric</a></li><li><a href="global.html#isValidArrayIndex">isValidArrayIndex</a></li><li><a href="global.html#LayerType">LayerType</a></li><li><a href="global.html#LayerType%255Bundefined%255D">LayerType[undefined]</a></li><li><a href="global.html#LengthUnit">LengthUnit</a></li><li><a href="global.html#LengthUnit%255Bundefined%255D">LengthUnit[undefined]</a></li><li><a href="global.html#LoadStatus">LoadStatus</a></li><li><a href="global.html#LoadStatus%255Bundefined%255D">LoadStatus[undefined]</a></li><li><a href="global.html#ModelCacheFormat">ModelCacheFormat</a></li><li><a href="global.html#ModelCacheFormat%255Bundefined%255D">ModelCacheFormat[undefined]</a></li><li><a href="global.html#objectMerge">objectMerge</a></li><li><a href="global.html#oneOf">oneOf</a></li><li><a href="global.html#outFullScreen">outFullScreen</a></li><li><a href="global.html#parseTime">parseTime</a></li><li><a href="global.html#query">query</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#removeClass">removeClass</a></li><li><a href="global.html#removeViewshedAnalysis">removeViewshedAnalysis</a></li><li><a href="global.html#removeVisiblityAnalysis">removeVisiblityAnalysis</a></li><li><a href="global.html#rgbaToHex">rgbaToHex</a></li><li><a href="global.html#rgbToHex">rgbToHex</a></li><li><a href="global.html#statisticField">statisticField</a></li><li><a href="global.html#statisticFieldByDS">statisticFieldByDS</a></li><li><a href="global.html#throttle">throttle</a></li><li><a href="global.html#toArray">toArray</a></li><li><a href="global.html#toggleClass">toggleClass</a></li><li><a href="global.html#toNumber">toNumber</a></li><li><a href="global.html#unique">unique</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#uuid">uuid</a></li><li><a href="global.html#viewshedAnalysis">viewshedAnalysis</a></li><li><a href="global.html#visiblityAnalysis">visiblityAnalysis</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <span class="page-title-sub">dist/src/model/feature/arcgis-feature-query.js</span>
                    <span class="page-title-main">Source</span>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import axios from 'axios';
import qs from 'qs';
export default class ArcGISFeatureQuery {
    /**
     * ArcGIS查询
     * geometryPrecision代表
     * distance代表模糊半径范围
     * outfields
     * @param {object} params
     * @param {string|null} params.where
     * @param {number|null} params.geometryPrecision 返回要素的物理坐标精度
     * @param {string|null} params.outFields 代表需要查询的字段属性名称（全部时用*）
     * @param {string|null} params.f
     * @param {string|null} params.text
     * @param {string|null} params.objectIds
     * @param {string|null} params.time
     * @param {string|null} params.inSR
     * @param {string|null} params.outSR
     * @param {string|null} params.spatialRel
     * @param {string|null} params.relationParam
     * @param {string|null} params.maxAllowableOffset
     * @param {string|null} params.orderByFields
     * @param {string|null} params.groupByFieldsForStatistics
     * @param {string|null} params.gdbVersion
     * @param {string|null} params.outStatistics
     * @param {string|null} params.queryByDistance
     * @param {boolean|null} params.returnGeometry
     * @param {boolean|null} params.returnIdsOnly
     * @param {boolean|null} params.returnCountOnly
     * @param {boolean|null} params.returnZ
     * @param {boolean|null} params.returnM
     * @param {boolean|null} params.returnDistinctValues
     * @param {boolean|null} params.returnExtentsOnly
     * @param {boolean|null} params.rtnLabel
     * @param {number|null} params.totalCount
     * @param {object} params.geometry 几何对象
     * @param {string|null} params.layerIndex 索引号
     * @param {number} params.page 页码
     * @param {number} params.pageCount 每页显示数
     */
    static query(params) {
        if (!params || !params.serverUrl) {
            return;
        }
        const tempParams = this.getQueryParams(params);
        tempParams.returnCountOnly = false;
        const page = params.page || 0;
        const pageCount = params.pageCount || 0;
        tempParams.resultOffset = page * pageCount || 0;
        tempParams.resultRecordCount = params.pageCount || 20;
        tempParams.objectIdsTotal = params.totalCount;
        const url = `${tempParams.serverUrl}/${tempParams.layerIndex}/query`;
        const promise = new Promise((resolve, reject) => {
            const instance = axios.create();
            instance.interceptors.request.use(config => {
                let url = config.url;
                // get参数编码
                if (config.method === 'get' &amp;&amp; config.params) {
                    url += '?';
                    const keys = Object.keys(config.params);
                    for (const key of keys) {
                        url += `${key}=${encodeURIComponent(config.params[key])}&amp;`;
                    }
                    url = url?.substring(0, url.length - 1);
                    config.params = {};
                }
                config.url = url;
                return config;
            });
            instance
                .get(url, {
                paramsSerializer(param) {
                    return qs.stringify(param);
                },
                params: tempParams
            })
                .then(res => {
                const { data } = res;
                if (!data) {
                    resolve(undefined);
                }
                else if (data.error) {
                    // 出现了返回data = {error: {code:400, message...}}的情况
                    reject(data.error.message);
                }
                else {
                    // 将data转geojson
                    const geojsonFeatures = {
                        type: 'FeatureCollection',
                        features: [],
                        dataCount: params.totalCount
                    };
                    const { features, geometryType } = data;
                    for (let i = 0; i &lt; features.length; i += 1) {
                        let coordinates = [];
                        let type = '';
                        let bound = {};
                        if (geometryType === 'esriGeometryPoint') {
                            // 如果为点要素
                            coordinates = [features[i].geometry.x, features[i].geometry.y];
                            type = 'Point';
                            bound = {
                                xmin: features[i].geometry.x,
                                ymin: features[i].geometry.y,
                                xmax: features[i].geometry.x,
                                ymax: features[i].geometry.y
                            };
                        }
                        else if (geometryType === 'esriGeometryPolyline') {
                            // 如果为线要素
                            const path = features[i].geometry.paths[0];
                            let xmin = path[0][0];
                            let xmax = path[0][0];
                            let ymin = path[0][1];
                            let ymax = path[0][1];
                            for (let j = 0; j &lt; path.length; j += 1) {
                                xmin = xmin &lt; path[j][0] ? xmin : path[j][0];
                                xmax = xmax > path[j][0] ? xmax : path[j][0];
                                ymin = ymin &lt; path[j][1] ? ymin : path[j][1];
                                ymax = ymax > path[j][1] ? ymax : path[j][1];
                                const coord = [...path[j]];
                                coordinates.push(coord);
                            }
                            type = 'LineString';
                            bound = { xmin, ymin, xmax, ymax };
                        }
                        else if (geometryType === 'esriGeometryPolygon') {
                            // 如果为面要素
                            const path = features[i].geometry.rings[0];
                            const arc = [];
                            let xmin = path[0][0];
                            let xmax = path[0][0];
                            let ymin = path[0][1];
                            let ymax = path[0][1];
                            for (let j = 0; j &lt; path.length; j += 1) {
                                xmin = xmin &lt; path[j][0] ? xmin : path[j][0];
                                xmax = xmax > path[j][0] ? xmax : path[j][0];
                                ymin = ymin &lt; path[j][1] ? ymin : path[j][1];
                                ymax = ymax > path[j][1] ? ymax : path[j][1];
                                const coord = [path[j].x, path[j].y];
                                arc.push(coord);
                            }
                            coordinates.push(arc);
                            type = 'Polygon';
                            bound = { xmin, ymin, xmax, ymax };
                        }
                        const geometry = {
                            type,
                            coordinates
                        };
                        const feature = {
                            type: 'Feature',
                            properties: { ...features[i].attributes },
                            geometry,
                            bound
                        };
                        geojsonFeatures.features.push(feature);
                    }
                    resolve(geojsonFeatures);
                }
            });
        });
        return promise.then(data => {
            return data;
        });
    }
    static getQueryParams(params) {
        const tempParams = {};
        tempParams.where = params.where || '1=1';
        tempParams.geometryPrecision = params.geometryPrecision || 3;
        tempParams.outFields = params.outFields || '*';
        tempParams.f = params.f || 'pjson';
        tempParams.text = params.text || '';
        tempParams.objectIds = params.objectIds || '';
        tempParams.time = params.time || '';
        tempParams.spatialRel = params.spatialRel || '';
        tempParams.relationParam = params.relationParam || '';
        tempParams.maxAllowableOffset = params.maxAllowableOffset || '';
        tempParams.orderByFields = params.orderByFields || '';
        tempParams.groupByFieldsForStatistics =
            params.groupByFieldsForStatistics || '';
        tempParams.gdbVersion = params.gdbVersion || '';
        tempParams.outStatistics = params.outStatistics || '';
        tempParams.returnGeometry =
            params.returnGeometry === false ? params.returnGeometry : true;
        tempParams.returnIdsOnly = params.returnIdsOnly || false;
        tempParams.returnCountOnly = params.returnCountOnly || false;
        tempParams.returnZ = params.returnZ || false;
        tempParams.returnM = params.returnM || false;
        tempParams.returnDistinctValues = params.returnDistinctValues || false;
        tempParams.returnExtentOnly = params.returnExtentsOnly || false;
        tempParams.layerIndex = params.layerIndex || 0;
        tempParams.returnTrueCurves = params.returnTrueCurves || false;
        tempParams.serverUrl = params.serverUrl;
        tempParams.totalCount = params.totalCount;
        if (params.queryByDistance) {
            tempParams.queryByDistance = params.queryByDistance;
        }
        else if (params.geometry &amp;&amp; params.geometry.nearDis) {
            tempParams.queryByDistance = params.geometry.nearDis;
        }
        else
            tempParams.queryByDistance = '';
        let EPSGNo = '';
        const { inSR } = params;
        if (params.inSR) {
            EPSGNo = params.inSR.split(':')[1];
        }
        tempParams.inSR = inSR || '';
        const { outSR } = params;
        tempParams.outSR = outSR || '';
        if (params.geometry) {
            const geoType = params.geometry.getGeometryType();
            const { geometry } = params;
            const pointArr = [];
            let i = 0;
            if (geoType === 'rect') {
                tempParams.geometry = JSON.stringify({
                    xmin: geometry.xmin,
                    ymin: geometry.ymin,
                    xmax: geometry.xmax,
                    ymax: geometry.ymax,
                    spatialReference: {
                        // EPSG: Zondy.OneMap.defaultData.projection.split(':')[1]
                        EPSG: 4326
                    }
                }); // [geometry.xmin, geometry.ymin, geometry.xmax, geometry.ymax].toString();
                tempParams.geometryType = 'esriGeometryEnvelope';
                tempParams.distance = params.geometry.nearDis || '';
            }
            else if (geoType === 'point') {
                tempParams.geometry = JSON.stringify({
                    x: geometry.x,
                    y: geometry.y,
                    spatialReference: { EPSG: EPSGNo }
                }); // [geometry.x, geometry.y].toString();
                tempParams.geometryType = 'esriGeometryPoint';
                tempParams.distance = params.geometry.nearDis || '';
            }
            else if (geoType === 'polygon') {
                tempParams.geometryType = 'esriGeometryPolygon';
                tempParams.distance === params.geometry.nearDis || '';
                for (i = 0; i &lt; geometry.pointArr.length; i++) {
                    pointArr.push([geometry.pointArr[i].x, geometry.pointArr[i].y]);
                }
                tempParams.geometry = JSON.stringify({
                    rings: [pointArr],
                    spatialReference: { EPSG: EPSGNo }
                });
            }
            else if (geoType === 'line') {
                tempParams.geometryType = 'esriGeometryPolyline';
                tempParams.distance === params.geometry.nearDis || '';
                for (i = 0; i &lt; geometry.pointArr.length; i++) {
                    pointArr.push([geometry.pointArr[i].x, geometry.pointArr[i].y]);
                }
                tempParams.geometry = JSON.stringify({
                    paths: [pointArr],
                    spatialReference: { EPSG: EPSGNo }
                });
            }
            else if (geoType === 'Circle') {
                // ArcGIS没有圆几何，将圆构造为polygon
                // tempParams.geometryType = "esriGeometryPolygon";
                // tempParams.distance === params.geometry.nearDis||'';
                // const Circle = new ol.geom.Circle([geometry.point.x, geometry.point.y], geometry.radious);
                // const polygon = new ol.geom.Polygon.fromCircle(Circle,16);
                // tempParams.geometry = JSON.stringify({ "rings": [polygon.getCoordinates()[0]], "spatialReference": { "EPSG": EPSGNo } });
            }
        }
        return tempParams;
    }
    /**
     * ArcGIS查询
     * geometryPrecision代表
     * distance代表模糊半径范围
     * outfields
     * @param {object} params
     * @param {string|null} params.where
     * @param {number|null} params.geometryPrecision 返回要素的物理坐标精度
     * @param {string|null} params.outFields 代表需要查询的字段属性名称（全部时用*）
     * @param {string|null} params.f
     * @param {string|null} params.text
     * @param {string|null} params.objectIds
     * @param {string|null} params.time
     * @param {string|null} params.inSR
     * @param {string|null} params.outSR
     * @param {string|null} params.spatialRel
     * @param {string|null} params.relationParam
     * @param {string|null} params.maxAllowableOffset
     * @param {string|null} params.orderByFields
     * @param {string|null} params.groupByFieldsForStatistics
     * @param {string|null} params.gdbVersion
     * @param {string|null} params.outStatistics
     * @param {string|null} params.queryByDistance
     * @param {boolean|null} params.returnGeometry
     * @param {boolean|null} params.returnIdsOnly
     * @param {boolean|null} params.returnCountOnly
     * @param {boolean|null} params.returnZ
     * @param {boolean|null} params.returnM
     * @param {boolean|null} params.returnDistinctValues
     * @param {boolean|null} params.returnExtentsOnly
     * @param {boolean|null} params.rtnLabel
     * @param {number|null} params.totalCount
     * @param {object} params.geometry 几何对象
     * @param {string|null} params.layerIndex 索引号
     * @param {string} params.serverUrl 服务地址
     */
    static getTotal(params) {
        if (!params.serverUrl) {
            return;
        }
        const tempParams = this.getQueryParams(params);
        tempParams.returnDistinctValues = false;
        if (params.totalCount) {
            return params.totalCount;
        }
        tempParams.returnIdsOnly = false;
        tempParams.returnCountOnly = true;
        tempParams.returnGeometry = false;
        tempParams.layerIndex = params.layerIndex || '0';
        const url = `${tempParams.serverUrl}/${tempParams.layerIndex}/query`;
        const promise = new Promise((resolve, reject) => {
            const instance = axios.create();
            instance.interceptors.request.use(config => {
                let url = config.url;
                // get参数编码
                if (config.method === 'get' &amp;&amp; config.params) {
                    url += '?';
                    const keys = Object.keys(config.params);
                    for (const key of keys) {
                        url += `${key}=${encodeURIComponent(config.params[key])}&amp;`;
                    }
                    url = url?.substring(0, url.length - 1);
                    config.params = {};
                }
                config.url = url;
                return config;
            });
            instance.get(url, { params: tempParams }).then(res => {
                const { data } = res;
                if (!data) {
                    resolve(undefined);
                }
                else {
                    resolve(data);
                }
            });
        });
        return promise.then(data => {
            return data;
        });
    }
    /**
     * 返回ArcGIS图层的属性结构
     * geometryPrecision代表
     * distance代表模糊半径范围
     * outfields
     * @param {object} queryParams
     * @param {string|null} queryParams.layerIndex 索引号
     * @param {string} queryParams.serverUrl 服务地址
     *  @param {string} queryParams.outFields 输出字段
     * @param {string} queryParams.page 页码
     * @param {string} queryParams.pageCount 每页记录数
     */
    static getLayerFileds(queryParams) {
        if (!queryParams || !queryParams.serverUrl) {
            return;
        }
        const tempParams = {};
        tempParams.where = '1=1';
        tempParams.outFields = queryParams.outFields || '*';
        tempParams.f = 'pjson';
        tempParams.layerIndex = queryParams.layerIndex || 0;
        tempParams.serverUrl = queryParams.serverUrl;
        tempParams.returnGeometry = true;
        tempParams.returnIdsOnly = false;
        tempParams.returnCountOnly = false;
        tempParams.resultOffset = queryParams.page * queryParams.pageCount || 0;
        tempParams.resultRecordCount = queryParams.pageCount || 1;
        const url = `${tempParams.serverUrl}/${tempParams.layerIndex}/query`;
        const promise = new Promise((resolve, reject) => {
            const instance = axios.create();
            instance.interceptors.request.use(config => {
                let url = config.url;
                // get参数编码
                if (config.method === 'get' &amp;&amp; config.params) {
                    url += '?';
                    const keys = Object.keys(config.params);
                    for (const key of keys) {
                        url += `${key}=${encodeURIComponent(config.params[key])}&amp;`;
                    }
                    url = url?.substring(0, url.length - 1);
                    config.params = {};
                }
                config.url = url;
                return config;
            });
            axios.get(url, { params: tempParams }).then(res => {
                const { data } = res;
                if (!data) {
                    resolve(undefined);
                }
                else {
                    const { fields } = data;
                    if (!fields) {
                        resolve(undefined);
                    }
                    else {
                        const tempFields = [];
                        const value = [];
                        for (let m = 0; m &lt; fields.length; m++) {
                            let type = '';
                            if (fields[m].type === 'esriFieldTypeOID') {
                                type = 'int';
                            }
                            else if (fields[m].type === 'esriFieldTypeDouble') {
                                type = 'double';
                            }
                            else if (fields[m].type === 'esriFieldTypeString') {
                                type = 'string';
                            }
                            else if (fields[m].type === 'esriFieldTypeInteger') {
                                type = 'int';
                            }
                            else if (fields[m].type === 'esriFieldTypeFloat') {
                                type = 'float';
                            }
                            else if (fields[m].type === 'esriFieldTypeDate') {
                                type = 'date';
                            }
                            else if (fields[m].type === 'esriFieldTypeSmallInteger') {
                                type = 'smallInteger';
                            }
                            tempFields.push({ name: fields[m].name, type });
                        }
                        if (tempParams.outFields &amp;&amp; tempParams.outFields !== '*') {
                            // 获取单个属性的属性值
                            const { features } = data;
                            for (let i = 0; i &lt; features.length; i += 1) {
                                const item = features[i].attributes[tempParams.outFields];
                                value.push(item);
                            }
                        }
                        const obj = {
                            fields: tempFields,
                            value
                        };
                        resolve(obj);
                    }
                }
            });
        });
        return promise.then(data => {
            return data;
        });
    }
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>文档生成<a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a></p>
                    <p class="sidebar-created-by">
                        <a href="http://develop.smaryun.com:8899/" target="_blank">MapGIS Web App Framework</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>

</body>
</html>
